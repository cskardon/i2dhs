```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Packages}
library("tidyverse")
library("sf")
source('functions.r')
```



```{r "read in file"}
file <- "./maps/Local_Authority_Boundaries_-_Scotland.json"
data <- st_read(file)

print(data)
```

```{r }
print(data$local_authority)
```

```{r "base plot"}
plot(data$geometry, col = "grey")
```

```{r "base plot"}
highlight = data[data$local_authority == "Dumfries and Galloway", ] 
# You can access this like: data[1, ], but this filtering allows from the naming.. 

plot(st_geometry(highlight), col = "red", add=TRUE)
```

Reading in the CSV file with the local authorities in.

```{r "Read ScoPHO"}
file <- './data/ScotPHO - anxiety, depression, psychosis - local authorities- all years.csv'
scotpho = read_csv(file)
```

Need to tweak the data naming of Local Authorities:

* The GeoJSON output uses `and` instead of `&`
* In GeoJSON we have `Na h-Eileanan an Iar` in the ScotPHO data we have `Na h-Eileanan Siar`

It is easier to do a replace all on the dataframe than the GeoJSON file. See the [`functions.r`](./functions.r) file for the definition

```{r "Tidy data for use in map"}
scotpho = tidy_names_of_scotpho_la_for_maps(scotpho)
```

If all the naming of the local authorites in the DataFrame is now correct - then the entire map should be coloured in orange.

```{r "Test if colouring map works"}
for(i in 1:nrow(scotpho)){
    la_name = scotpho[i, ]$area_name
    highlight <- data[data$local_authority == la_name, ] 
    plot(st_geometry(highlight), col = "orange", add=TRUE)
}
```
